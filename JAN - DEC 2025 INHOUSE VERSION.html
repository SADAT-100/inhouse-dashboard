<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 Monthly Deep Dive | INHOUSE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- IMPORTANT: Using xlsx-js-style for styling support -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>

    <style>
        /* --- THEME: DARK LUXURY --- */
        :root {
            --bg-dark: #020617;
            --bg-panel: #0f172a;
            --accent-gold: #fbbf24;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            
            /* Channel Colors */
            --c-amazon: #3b82f6;
            --c-noon: #fcd34d;
            --c-trendyol: #f97316;
            --c-small: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- SIDEBAR NAVIGATION --- */
        aside {
            width: 200px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        .back-btn {
            color: var(--text-muted); text-decoration: none; font-size: 0.8rem; font-weight: 700;
            margin-bottom: 30px; display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .back-btn:hover { color: var(--accent-gold); }

        .nav-title { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; font-weight: 700; }

        .month-link {
            padding: 10px 15px; border-radius: 6px; color: var(--text-main); cursor: pointer;
            margin-bottom: 5px; font-size: 0.9rem; transition: all 0.2s; border-left: 2px solid transparent;
        }
        .month-link:hover { background: rgba(255,255,255,0.05); }
        .month-link.active { background: rgba(251, 191, 36, 0.1); border-left-color: var(--accent-gold); color: var(--accent-gold); font-weight: 700; }

        /* --- MOBILE OVERLAY --- */
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 40; }

        /* --- MAIN CONTENT --- */
        main {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        header { margin-bottom: 50px; border-bottom: 1px solid var(--border); padding-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .header-top { display: flex; align-items: center; justify-content: space-between; gap: 15px; }
        .header-left { display: flex; align-items: center; gap: 15px; }

        .menu-btn { display: none; background: none; border: none; font-size: 1.5rem; color: var(--text-main); cursor: pointer; }

        h1 { font-size: 2.5rem; font-weight: 900; letter-spacing: -1px; color: var(--text-main); }
        .subtitle { color: var(--text-muted); margin-top: 5px; }

        /* EXCEL BUTTON */
        .excel-btn {
            background: #10b981;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        .excel-btn:hover { background: #059669; }
        .excel-icon { font-size: 1.1rem; }

        /* --- MONTH SECTION --- */
        .month-section { margin-bottom: 80px; scroll-margin-top: 20px; }
        
        .month-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .month-title { font-size: 1.8rem; font-weight: 700; color: var(--text-main); border-left: 4px solid var(--accent-gold); padding-left: 15px; }
        
        /* Summary Cards */
        .month-summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .m-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        .m-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }
        .m-val { font-size: 1.2rem; font-weight: 700; color: var(--text-main); margin-top: 5px; }

        /* --- TABLE --- */
        .table-container {
            background: var(--bg-panel); border-radius: 12px; border: 1px solid var(--border);
            overflow-x: auto; /* Horizontal scroll for mobile */
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 600px; /* Force width on mobile */ }
        
        th { 
            background: #0b1120; color: var(--text-muted); font-weight: 600; text-align: right; 
            padding: 15px; text-transform: uppercase; font-size: 0.75rem; 
        }
        th:first-child { text-align: left; padding-left: 20px; position: sticky; left: 0; background: #0b1120; z-index: 10; }

        td { 
            padding: 15px; border-bottom: 1px solid var(--border); text-align: right; 
            color: var(--text-main); vertical-align: middle; 
        }
        td:first-child { 
            text-align: left; padding-left: 20px; font-weight: 600; display: flex; align-items: center; gap: 10px;
            position: sticky; left: 0; background: var(--bg-panel); z-index: 5; border-right: 1px solid var(--border);
        }
        tr:last-child td { border-bottom: none; }

        .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .margin-bar-bg { width: 80px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; display: inline-block; margin-left: 10px; }
        .margin-bar-fill { height: 100%; border-radius: 3px; }
        .row-total { background: rgba(251, 191, 36, 0.05); font-weight: 800; }
        .row-total td { color: var(--accent-gold); border-top: 2px solid var(--border); }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .header-top { flex-direction: column; align-items: flex-start; }
            .excel-btn { width: 100%; justify-content: center; }
            aside {
                position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%);
                width: 250px; z-index: 100;
            }
            aside.active { transform: translateX(0); }
            .sidebar-overlay.active { display: block; }
            
            .menu-btn { display: block; }
            main { padding: 20px; }
            h1 { font-size: 1.8rem; }
            .month-summary { grid-template-columns: 1fr 1fr; } /* 2x2 grid */
            
            td:first-child { min-width: 120px; } 
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="sidebar-overlay" onclick="toggleMenu()"></div>

    <aside id="sidebar">
        <a href="inhouse_reports.html" class="back-btn">← Back to Report</a>
        <div class="nav-title">Jump to Month</div>
        <div id="nav-container">
            <!-- JS will populate links -->
        </div>
    </aside>

    <main>
        <header>
            <div class="header-top">
                <div class="header-left">
                    <button class="menu-btn" onclick="toggleMenu()">☰</button>
                    <h1>2025 Financial Detail</h1>
                </div>
                <button class="excel-btn" onclick="exportExcel()">
                    <span class="excel-icon">⇩</span> Download Excel Report
                </button>
            </div>
            <p class="subtitle">Complete breakdown of Revenue, Cost, and Profit by Channel</p>
        </header>

        <div id="months-container">
            <!-- JS will generate 12 tables here -->
        </div>
    </main>

<script>
    // --- 1. REAL 2025 DATA SOURCE (Updated with Delivered Only Trendyol Data) ---
    const DB = {
        "Jan": [
            { ch: "Amazon", sales: 303381, cost: 227772, ads: 25158, profit: 50451, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 238928, cost: 156811, ads: 0, profit: 82117, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 494653, cost: 360200, ads: 0, profit: 134453, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 266597, cost: 160475, ads: 0, profit: 106122, color: "var(--c-small)" }
        ],
        "Feb": [
            { ch: "Amazon", sales: 407655, cost: 312689, ads: 55766, profit: 39200, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 306351, cost: 206258, ads: 0, profit: 100093, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 174941, cost: 112473, ads: 0, profit: 62468, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 262366, cost: 172306, ads: 0, profit: 90060, color: "var(--c-small)" }
        ],
        "Mar": [
            { ch: "Amazon", sales: 503612, cost: 404602, ads: 74763, profit: 24247, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 400871, cost: 280220, ads: 0, profit: 120651, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 293390, cost: 212303, ads: 0, profit: 81087, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 281319, cost: 196984, ads: 0, profit: 84335, color: "var(--c-small)" }
        ],
        "Apr": [
            { ch: "Amazon", sales: 310465, cost: 269060, ads: 38423, profit: 2982, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 298171, cost: 200787, ads: 0, profit: 97384, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 92446, cost: 64559, ads: 0, profit: 27887, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 132785, cost: 83921, ads: 0, profit: 48864, color: "var(--c-small)" }
        ],
        "May": [
            { ch: "Amazon", sales: 320677, cost: 256133, ads: 39679, profit: 24865, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 367050, cost: 252576, ads: 0, profit: 114474, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 111078, cost: 77988, ads: 0, profit: 33090, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 165011, cost: 106490, ads: 0, profit: 58521, color: "var(--c-small)" }
        ],
        "Jun": [
            { ch: "Amazon", sales: 331208, cost: 272754, ads: 42429, profit: 16025, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 222440, cost: 140997, ads: 0, profit: 81443, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 124158, cost: 90571, ads: 0, profit: 33587, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 116782, cost: 67003, ads: 0, profit: 49779, color: "var(--c-small)" }
        ],
        "Jul": [
            { ch: "Amazon", sales: 593876, cost: 505621, ads: 57054, profit: 31201, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 285799, cost: 188403, ads: 0, profit: 97396, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 151741, cost: 126597, ads: 0, profit: 25144, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 227476, cost: 159000, ads: 0, profit: 68476, color: "var(--c-small)" }
        ],
        "Aug": [
            { ch: "Amazon", sales: 423798, cost: 354044, ads: 44869, profit: 24885, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 235315, cost: 155138, ads: 0, profit: 80177, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 425394, cost: 363689, ads: 0, profit: 61705, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 143198, cost: 91603, ads: 0, profit: 51595, color: "var(--c-small)" }
        ],
        "Sep": [
            { ch: "Amazon", sales: 433087, cost: 358155, ads: 58816, profit: 16116, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 167806, cost: 105883, ads: 0, profit: 61923, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 206688, cost: 161589, ads: 0, profit: 45099, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 138987, cost: 83962, ads: 0, profit: 55025, color: "var(--c-small)" }
        ],
        "Oct": [
            { ch: "Amazon", sales: 355072, cost: 319673, ads: 32101, profit: 3298, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 150848, cost: 95314, ads: 0, profit: 55534, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 192279, cost: 169956, ads: 0, profit: 22323, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 104874, cost: 63724, ads: 0, profit: 41150, color: "var(--c-small)" }
        ],
        "Nov": [
            { ch: "Amazon", sales: 1770108, cost: 1347988, ads: 78122, profit: 343998, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 201461, cost: 142845, ads: 0, profit: 58616, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 381481, cost: 333977, ads: 0, profit: 47504, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 131516, cost: 83476, ads: 0, profit: 48040, color: "var(--c-small)" }
        ],
        "Dec": [
            { ch: "Amazon", sales: -22470, cost: -48536, ads: 29246, profit: -3180, color: "var(--c-amazon)" },
            { ch: "Noon", sales: 143074, cost: 90039, ads: 0, profit: 53035, color: "var(--c-noon)" },
            { ch: "Trendyol", sales: 129714, cost: 105807, ads: 0, profit: 23907, color: "var(--c-trendyol)" },
            { ch: "Small Ch.", sales: 145756, cost: 89639, ads: 0, profit: 56117, color: "var(--c-small)" }
        ]
    };

    const monthsList = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

    function toggleMenu() {
        document.querySelector('aside').classList.toggle('active');
        document.querySelector('.sidebar-overlay').classList.toggle('active');
    }

    function format(num) {
        return new Intl.NumberFormat('en-US').format(Math.round(num));
    }

    function renderPage() {
        const nav = document.getElementById('nav-container');
        const main = document.getElementById('months-container');

        monthsList.forEach(month => {
            const data = DB[month];
            
            // Sidebar Link
            const link = document.createElement('div');
            link.className = 'month-link';
            link.innerText = month + " 2025";
            link.onclick = () => {
                document.getElementById(`sec-${month}`).scrollIntoView();
                document.querySelector('aside').classList.remove('active');
                document.querySelector('.sidebar-overlay').classList.remove('active');
            };
            nav.appendChild(link);

            // Calculate Totals
            let tSales = 0, tProfit = 0, tAds = 0;
            data.forEach(r => { tSales += r.sales; tProfit += r.profit; tAds += r.ads; });
            const tMargin = tSales !== 0 ? (tProfit / tSales) * 100 : 0;

            // HTML Section
            const section = document.createElement('section');
            section.className = 'month-section';
            section.id = `sec-${month}`;
            
            let rowsHTML = "";
            data.forEach(row => {
                const margin = row.sales !== 0 ? (row.profit / row.sales) * 100 : 0;
                const marginColor = margin < 10 ? '#ef4444' : (margin > 25 ? '#10b981' : '#f59e0b');
                
                rowsHTML += `
                    <tr>
                        <td><div class="dot" style="background:${row.color}"></div> ${row.ch}</td>
                        <td>${format(row.sales)}</td>
                        <td>${format(row.cost)}</td>
                        <td>${format(row.ads)}</td>
                        <td>${format(row.profit)}</td>
                        <td>
                            ${margin.toFixed(1)}% 
                            <div class="margin-bar-bg">
                                <div class="margin-bar-fill" style="width:${Math.max(0, margin)}%; background:${marginColor}"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });

            section.innerHTML = `
                <div class="month-header">
                    <div class="month-title">${month} 2025</div>
                </div>

                <div class="month-summary">
                    <div class="m-card"><div class="m-label">Total Revenue</div><div class="m-val">${format(tSales)}</div></div>
                    <div class="m-card"><div class="m-label">Total Profit</div><div class="m-val" style="color:#10b981">${format(tProfit)}</div></div>
                    <div class="m-card"><div class="m-label">Net Margin</div><div class="m-val">${tMargin.toFixed(1)}%</div></div>
                    <div class="m-card"><div class="m-label">Ad Spend</div><div class="m-val" style="color:#ef4444">${format(tAds)}</div></div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Channel</th>
                                <th>Revenue (SAR)</th>
                                <th>COGS & Fees</th>
                                <th>Ad Spend</th>
                                <th>Net Profit</th>
                                <th>Net Margin %</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                            <tr class="row-total">
                                <td>TOTAL</td>
                                <td>${format(tSales)}</td>
                                <td>--</td>
                                <td>${format(tAds)}</td>
                                <td>${format(tProfit)}</td>
                                <td>${tMargin.toFixed(1)}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            main.appendChild(section);
        });
    }

    // --- EXCEL EXPORT FUNCTIONALITY ---
    function exportExcel() {
        const wb = XLSX.utils.book_new();
        let rows = [];

        // Define Styles
        const styleTitle = { 
            font: { bold: true, color: { rgb: "FFFFFF" }, sz: 16 }, 
            fill: { fgColor: { rgb: "020617" } },
            alignment: { horizontal: "center" }
        };
        const styleMonthHeader = { 
            font: { bold: true, color: { rgb: "FFFFFF" }, sz: 12 }, 
            fill: { fgColor: { rgb: "0F172A" } },
            border: { top: {style: "thin"}, bottom: {style: "thin"} }
        };
        const styleColHeader = { 
            font: { bold: true, color: { rgb: "000000" } }, 
            fill: { fgColor: { rgb: "E2E8F0" } },
            border: { top: {style: "thin"}, bottom: {style: "thin"}, left: {style: "thin"}, right: {style: "thin"} }
        };
        const styleData = {
            border: { top: {style: "thin"}, bottom: {style: "thin"}, left: {style: "thin"}, right: {style: "thin"} },
            numFmt: "#,##0"
        };
        const styleDataPct = {
            border: { top: {style: "thin"}, bottom: {style: "thin"}, left: {style: "thin"}, right: {style: "thin"} },
            numFmt: "0.0%"
        };
        const styleTotal = {
            font: { bold: true, color: { rgb: "B45309" } },
            fill: { fgColor: { rgb: "FEF3C7" } },
            border: { top: {style: "medium"} },
            numFmt: "#,##0"
        };
        const styleTotalPct = {
            font: { bold: true, color: { rgb: "B45309" } },
            fill: { fgColor: { rgb: "FEF3C7" } },
            border: { top: {style: "medium"} },
            numFmt: "0.0%"
        };

        // 1. Add Main Title
        rows.push([ { v: "EXECUTIVE PERFORMANCE REPORT 2025", s: styleTitle } ]);
        rows.push([""]); // Spacer

        // 2. Loop through Months
        monthsList.forEach(month => {
            const data = DB[month];
            
            // Calculate Totals for the Month
            let tSales = 0, tProfit = 0, tAds = 0;
            data.forEach(r => { tSales += r.sales; tProfit += r.profit; tAds += r.ads; });
            const tMargin = tSales ? (tProfit / tSales) : 0;

            // Month Header
            rows.push([ { v: month + " 2025", s: styleMonthHeader }, "", "", "", "", "" ]);
            
            // Column Headers
            rows.push([
                { v: "Channel", s: styleColHeader },
                { v: "Revenue", s: styleColHeader },
                { v: "COGS & Fees", s: styleColHeader },
                { v: "Ad Spend", s: styleColHeader },
                { v: "Net Profit", s: styleColHeader },
                { v: "Net Margin", s: styleColHeader }
            ]);

            // Data Rows
            data.forEach(r => {
                const margin = r.sales ? (r.profit / r.sales) : 0;
                rows.push([
                    { v: r.ch, s: styleData },
                    { v: r.sales, s: styleData, t: 'n' },
                    { v: r.cost, s: styleData, t: 'n' },
                    { v: r.ads, s: styleData, t: 'n' },
                    { v: r.profit, s: styleData, t: 'n' },
                    { v: margin, s: styleDataPct, t: 'n' }
                ]);
            });

            // Total Row
            rows.push([
                { v: "TOTAL", s: styleTotal },
                { v: tSales, s: styleTotal, t: 'n' },
                { v: "-", s: styleTotal },
                { v: tAds, s: styleTotal, t: 'n' },
                { v: tProfit, s: styleTotal, t: 'n' },
                { v: tMargin, s: styleTotalPct, t: 'n' }
            ]);

            // Spacer Row
            rows.push([""]);
        });

        // 3. Create Worksheet
        const ws = XLSX.utils.aoa_to_sheet([]); // Initialize empty
        
        // 4. Manually add cells (aoa_to_sheet strips styles in some versions, manual is safer for styled cells)
        // Actually, xlsx-js-style allows aoa_to_sheet with objects. Let's try direct assignment.
        XLSX.utils.sheet_add_aoa(ws, rows, { origin: "A1" });

        // 5. Set Column Widths
        ws['!cols'] = [
            { wpx: 120 }, // Channel
            { wpx: 100 }, // Rev
            { wpx: 100 }, // Cost
            { wpx: 100 }, // Ads
            { wpx: 100 }, // Profit
            { wpx: 80 }   // Margin
        ];

        // 6. Merge Month Headers (A to F)
        const merges = [];
        let currentRow = 0;
        // Need to calculate where the month headers are to merge them
        // Title is row 0. Spacer row 1.
        // For every month: Header(1) + ColHead(1) + 4 Data rows + Total(1) + Spacer(1) = 8 rows/month
        // Title (1) + Spacer (1) = Start at index 2
        
        merges.push({ s: { r: 0, c: 0 }, e: { r: 0, c: 5 } }); // Main Title Merge

        let rIndex = 2; 
        monthsList.forEach(m => {
            merges.push({ s: { r: rIndex, c: 0 }, e: { r: rIndex, c: 5 } }); // Month Header Merge
            rIndex += (DB[m].length + 4); // Header + ColHead + DataLength + Total + Spacer
        });
        ws['!merges'] = merges;

        // 7. Write File
        XLSX.utils.book_append_sheet(wb, ws, "2025 Financials");
        XLSX.writeFile(wb, "INHOUSE_2025_Executive_Report.xlsx");
    }

    // Init
    renderPage();

    // Scroll Spy for Sidebar Active State
    const contentBox = document.querySelector("main");
    const sections = document.querySelectorAll(".month-section");
    const links = document.querySelectorAll(".month-link");

    contentBox.addEventListener("scroll", () => {
        let current = "";
        sections.forEach(sec => {
            const top = sec.offsetTop - contentBox.offsetTop;
            if (contentBox.scrollTop >= top - 100) {
                current = sec.getAttribute("id");
            }
        });
        links.forEach(li => {
            li.classList.remove("active");
            if (li.getAttribute("onclick").includes(current)) {
                li.classList.add("active");
            }
        });
    });

</script>

</body>
</html>
