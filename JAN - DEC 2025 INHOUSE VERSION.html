<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INHOUSE | Amazon 2025 Financials</title>
    
    <!-- FAVICON (Gold 'I') -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='16' fill='%230F172A'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='900' font-size='42' fill='%23AC975B'%3EI%3C/text%3E%3C/svg%3E">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <style>
        /* --- THEME DEFINITION (DARK DEFAULT) --- */
        :root {
            --bg-body: #02040a;       
            --bg-sidebar: #000205;
            --bg-card: #0F172A;       
            --bg-hover: #1E293B;
            --bg-gradient: radial-gradient(circle at top right, #101929 0%, transparent 40%);
            
            --c-brand: #AC975B;       
            --c-amazon: #3B82F6;      
            --c-noon: #FBBF24;        
            --c-trendyol: #F97316;    
            
            --c-text-main: #F8FAFC;
            --c-text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            
            --footer-bg: #111827;
            --footer-border: #374151;

            --c-success: #10B981;
            --c-danger: #EF4444;
        }

        /* --- LIGHT THEME OVERRIDES --- */
        [data-theme="light"] {
            --bg-body: #F1F5F9;       
            --bg-sidebar: #FFFFFF;
            --bg-card: #FFFFFF;       
            --bg-hover: #F8FAFC;
            --bg-gradient: radial-gradient(circle at top right, #E2E8F0 0%, transparent 40%);
            
            --c-text-main: #0F172A;
            --c-text-muted: #64748B;
            --border: rgba(0, 0, 0, 0.08);
            
            --footer-bg: #FFFFFF;
            --footer-border: #E2E8F0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }

        body {
            background-color: var(--bg-body);
            color: var(--c-text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- MOBILE MENU OVERLAY --- */
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index: 40; backdrop-filter: blur(4px); }
        .overlay.active { display: block; }

        /* --- SIDEBAR --- */
        aside {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 25px 15px;
            z-index: 50;
            flex-shrink: 0;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        .back-btn {
            color: var(--c-text-muted); text-decoration: none; font-size: 0.8rem; font-weight: 700;
            margin-bottom: 30px; display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .back-btn:hover { color: var(--c-brand); transform: translateX(-3px); }

        .brand-box { margin-bottom: 40px; padding-left: 10px; border-left: 4px solid var(--c-brand); }
        .brand-title { font-size: 1.6rem; font-weight: 900; color: var(--c-text-main); letter-spacing: -0.5px; line-height: 1; }
        .brand-sub { font-size: 0.75rem; color: var(--c-brand); font-weight: 600; letter-spacing: 2px; margin-top: 5px; text-transform: uppercase; }

        .nav-menu { display: flex; flex-direction: column; gap: 8px; }

        .nav-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; border-radius: 8px; cursor: pointer;
            color: var(--c-text-muted); font-size: 0.9rem; font-weight: 500;
            text-decoration: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .nav-item:hover { background: var(--bg-hover); color: var(--c-text-main); padding-left: 20px; }
        
        /* BRAND COLORS FOR NAV */
        .nav-item.active-amazon { background: rgba(59, 130, 246, 0.1); color: var(--c-amazon); border-color: rgba(59, 130, 246, 0.2); font-weight: 700; }
        .nav-item.brand-noon { color: var(--c-noon); } 
        .nav-item.brand-trendyol { color: var(--c-trendyol); } 

        .arrow { transition: transform 0.3s ease; font-size: 0.8rem; }
        
        .submenu {
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, opacity 0.3s ease;
            opacity: 0; margin-left: 15px; padding-left: 15px; border-left: 1px solid var(--border);
        }
        .submenu.open { max-height: 300px; opacity: 1; margin-top: 5px; margin-bottom: 10px; }

        .sub-link {
            display: block; padding: 8px 0; color: var(--c-text-muted); font-size: 0.85rem; text-decoration: none; transition: 0.2s;
        }
        .sub-link:hover { color: var(--c-brand); transform: translateX(5px); }

        /* --- MAIN AREA --- */
        main {
            flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column;
            background: var(--bg-gradient);
            position: relative;
        }

        /* HEADER LAYOUT */
        header { 
            display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 50px; 
        }
        .header-actions { display: flex; align-items: center; gap: 15px; }

        .page-title h1 { font-size: 2.2rem; font-weight: 800; margin-bottom: 5px; }
        .page-title p { color: var(--c-text-muted); }
        
        .header-top-mobile { display: none; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .menu-btn { background: none; border: none; color: var(--c-text-main); font-size: 1.5rem; cursor: pointer; }

        .btn-download {
            background: var(--c-success); color: white; border: none; padding: 12px 24px;
            border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;
            transition: 0.3s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }
        .btn-download:hover { background: #059669; transform: translateY(-2px); }

        /* NEW RAW DATA BUTTON */
        .btn-raw-data {
            background: transparent;
            color: var(--c-brand);
            border: 1px solid var(--c-brand);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        .btn-raw-data:hover {
            background: var(--c-brand);
            color: #000;
            transform: translateY(-2px);
        }

        /* THEME TOGGLE SWITCH */
        .theme-switch {
            position: relative; width: 60px; height: 30px;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 30px; cursor: pointer; display: flex; align-items: center;
            padding: 3px; transition: 0.3s;
        }
        .switch-handle {
            width: 24px; height: 24px; background: var(--c-brand);
            border-radius: 50%; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
        }
        [data-theme="light"] .switch-handle { transform: translateX(30px); background: #0F172A; color: #FFD700; }
        [data-theme="dark"] .switch-handle { transform: translateX(0); color: #000; }

        /* --- MONTH CARD --- */
        .month-wrapper { margin-bottom: 50px; animation: fadeInUp 0.5s ease-out forwards; opacity: 0; }
        .section-header {
            display: flex; align-items: center; margin-bottom: 15px;
            border-left: 4px solid var(--c-brand); padding-left: 15px;
        }
        .section-title { font-size: 1.5rem; font-weight: 700; color: var(--c-text-main); }
        .dashboard-card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
            padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: background-color 0.3s ease;
        }

        /* KPI ROW */
        .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .mini-kpi { background: var(--bg-body); border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .mk-label { font-size: 0.7rem; color: var(--c-text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
        .mk-value { font-size: 1.4rem; font-weight: 700; color: var(--c-text-main); }

        /* TABLE */
        .table-responsive { overflow-x: auto; }
        .styled-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 800px; /* Force scroll on small screens */ }
        
        .styled-table th {
            text-align: right; color: var(--c-text-muted); font-size: 0.75rem; text-transform: uppercase;
            padding: 15px; border-bottom: 1px solid var(--border); font-weight: 600;
        }
        .styled-table th:first-child { text-align: left; padding-left: 10px; }
        .styled-table td {
            text-align: right; padding: 15px; border-bottom: 1px solid var(--border);
            color: var(--c-text-main); vertical-align: middle;
        }
        .styled-table td:first-child { text-align: left; padding-left: 10px; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .styled-table tr:last-child td { border-bottom: none; }
        
        .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .row-shipped .dot { background: var(--c-amazon); }
        .row-return .dot { background: var(--c-danger); }
        .row-retail .dot { background: var(--c-brand); }
        
        .row-net { background: rgba(59, 130, 246, 0.08); font-weight: 700; }
        .row-net td { color: #60a5fa; border-top: 1px solid rgba(59, 130, 246, 0.2); }
        .row-net .dot { background: #60a5fa; box-shadow: 0 0 10px #60a5fa; }
        
        /* Progress Bar */
        .prog-track { width: 60px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; display: inline-block; margin-left: 10px; vertical-align: middle; }
        [data-theme="light"] .prog-track { background: rgba(0,0,0,0.1); }
        .prog-fill { height: 100%; border-radius: 2px; }

        /* --- SUMMARY FOOTER (NOT FIXED) --- */
        .summary-footer {
            margin-top: 40px; margin-bottom: 20px;
            background: var(--footer-bg);
            border: 1px solid var(--footer-border);
            border-radius: 12px;
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* Added QTY */
            gap: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            transition: background-color 0.3s ease;
        }

        .sf-item { display: flex; flex-direction: column; gap: 5px; padding-right: 20px; border-right: 1px solid var(--border); }
        .sf-item:last-child { border-right: none; }

        .sf-label { font-size: 0.75rem; color: var(--c-text-muted); letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; }
        .sf-val { font-size: 1.6rem; font-weight: 900; color: var(--c-text-main); letter-spacing: -0.5px; }
        .sf-sub { font-size: 0.8rem; color: #3B82F6; font-weight: 500; }
        
        /* Floating Insight Button */
        .fab-insight {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px; border-radius: 50%;
            background: #FBBF24; color: #000;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
            cursor: pointer; z-index: 90; transition: 0.3s;
            border: none; animation: pulse 2s infinite;
        }
        .fab-insight:hover { transform: scale(1.1); background: #FFF; }

        /* Floating Stats Button */
        .fab-stats {
            position: fixed; bottom: 30px; right: 100px; /* Shifted left */
            width: 60px; height: 60px; border-radius: 50%;
            background: var(--c-brand); color: #000;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; box-shadow: 0 10px 30px rgba(172, 151, 91, 0.4);
            cursor: pointer; z-index: 90; transition: 0.3s;
            border: none;
        }
        .fab-stats:hover { transform: scale(1.1); background: #fff; }

        /* INSIGHT MODAL */
        .insight-modal {
            display: none; position: fixed; bottom: 100px; right: 30px;
            width: 350px; background: var(--bg-card); border: 1px solid var(--c-brand);
            border-radius: 16px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            z-index: 95; animation: slideUp 0.3s ease-out;
        }
        .insight-modal.active { display: block; }
        .im-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .im-title { font-weight: 800; color: var(--c-brand); text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; }
        .im-close { cursor: pointer; color: var(--c-text-main); font-size: 1.2rem; }
        
        .insight-item { display: flex; gap: 12px; margin-bottom: 15px; }
        .ii-icon { font-size: 1.2rem; min-width: 25px; }
        .ii-text h4 { font-size: 0.9rem; color: var(--c-text-main); margin-bottom: 4px; }
        .ii-text p { font-size: 0.8rem; color: var(--c-text-muted); line-height: 1.4; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(251, 191, 36, 0); } 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 1024px) {
            .summary-footer { grid-template-columns: repeat(3, 1fr); gap: 30px; }
            .sf-item { border-right: none; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        }

        @media (max-width: 768px) {
            aside {
                position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%);
                width: 280px; z-index: 100;
            }
            aside.active { transform: translateX(0); }
            
            .header-top-mobile { display: flex; }
            header { flex-direction: column; align-items: flex-start; gap: 20px; }
            
            /* UPDATED: Mobile Header Actions */
            .header-actions { 
                width: 100%; 
                justify-content: space-between; 
                flex-wrap: wrap; 
                gap: 10px; 
            }
            .btn-download, .btn-raw-data { 
                width: 100%; 
                justify-content: center; 
            }
            
            .page-title h1 { font-size: 1.8rem; }
            
            main { padding: 20px; }
            
            .kpi-row { grid-template-columns: 1fr 1fr; }
            
            .summary-footer { grid-template-columns: 1fr; } 
            .sf-val { font-size: 2rem; }
            
            .insight-modal { width: 90%; right: 5%; bottom: 100px; }
            .fab-stats { right: 100px; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

    </style>
</head>
<body data-theme="dark">

    <!-- Mobile Overlay -->
    <div class="overlay" onclick="toggleMenu()"></div>

    <!-- Mobile Header -->
    <div class="header-top-mobile" style="position: absolute; top: 20px; left: 20px; z-index: 40;">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    </div>

    <aside id="sidebar">
        <!-- BACK BUTTON -->
        <a href="inhouse_reports.html" class="back-btn">‚Üê Back to Report</a>

        <div class="brand-box">
            <div class="brand-title">INHOUSE<span style="color:var(--c-brand)">.</span></div>
            <div class="brand-sub">Channel Reports</div>
        </div>

        <div class="nav-menu">
            <a href="#" class="nav-item active-amazon">
                <span>Amazon</span>
            </a>
            <a href="#" class="nav-item brand-noon">
                <span>Noon</span>
            </a>
            <a href="#" class="nav-item brand-trendyol">
                <span>Trendyol</span>
            </a>
            
            <div class="nav-item" onclick="toggleSmallChannels(this)">
                <span>Small Channels</span>
                <span class="arrow">‚ñº</span>
            </div>
            <div class="submenu" id="sm-submenu">
                <a href="#" class="sub-link">Home Center</a>
                <a href="#" class="sub-link">Al-Rugaib</a>
                <a href="#" class="sub-link">Centerpoint</a>
                <a href="#" class="sub-link">Retkom</a>
                <a href="#" class="sub-link">Homzmart</a>
                <a href="#" class="sub-link">Carrefour</a>
            </div>
        </div>
    </aside>

    <main>
        <header>
            <div class="page-title" style="margin-left: 40px;"> 
                <h1>Amazon 2025 Deep Dive</h1>
                <p>Detailed breakdown of Shipping, Returns, Retail, and Net Performance</p>
            </div>
            <div class="header-actions">
                <!-- Theme Toggle -->
                <div class="theme-switch" onclick="toggleTheme()" title="Switch Light/Dark Mode">
                    <div class="switch-handle">‚òÄ</div>
                </div>
                
                <!-- NEW BUTTON HERE -->
                <a href="amazon_raw_data.html" class="btn-raw-data">
                    OPEN RAW DATA ‚Üó
                </a>

                <button class="btn-download" onclick="exportAmazonFullExcel()">
                    Download Full Report ‚á©
                </button>
            </div>
        </header>

        <div id="content-area">
            <!-- JS Will Inject Month Cards Here -->
        </div>

        <!-- SUMMARY FOOTER (Collapsible Target) -->
        <div class="summary-footer" id="footer-summary">
            <div class="sf-item">
                <div class="sf-label">Total Net Qty</div>
                <div class="sf-val" id="year-qty" style="color:#A78BFA">0</div>
                <div class="sf-sub">Units Sold</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">Total Sales (Price)</div>
                <div class="sf-val" id="year-sales">0</div>
                <div class="sf-sub">Gross Sales</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">Total Net Revenue</div>
                <div class="sf-val" id="year-rev">0</div>
                <div class="sf-sub">SAR (Actuals)</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">Total Net Cost</div>
                <div class="sf-val" id="year-cost">0</div>
                <div class="sf-sub">COGS + Fees</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">Total Ad Spend</div>
                <div class="sf-val" id="year-ads" style="color:#EF4444">0</div>
                <div class="sf-sub">Direct Marketing</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">Net Profit</div>
                <div class="sf-val" id="year-profit">0</div>
                <div class="sf-sub">Realized Earnings</div>
            </div>
            <div class="sf-item">
                <div class="sf-label">YTD Margin</div>
                <div class="sf-val" id="year-margin" style="color:var(--c-amazon)">0%</div>
                <div class="sf-sub">Efficiency</div>
            </div>
        </div>

    </main>

    <!-- Floating Buttons -->
    <button class="fab-stats" onclick="scrollToStats()" title="View Summary">üìä</button>
    <button class="fab-insight" onclick="toggleInsight()" title="Profit Analysis">üí°</button>

    <!-- Insight Modal -->
    <div class="insight-modal" id="insight-modal">
        <div class="im-header">
            <div class="im-title">PROFIT ANALYSIS</div>
            <div class="im-close" onclick="toggleInsight()">√ó</div>
        </div>
        <div class="insight-item">
            <div class="ii-icon">‚ö†Ô∏è</div>
            <div class="ii-text">
                <h4>Ad Spend Drain (1:1 Ratio)</h4>
                <p>We are spending 1 SAR on Ads for every 1 SAR kept in profit. ACOS is eating margins.</p>
            </div>
        </div>
        <div class="insight-item">
            <div class="ii-icon">üìâ</div>
            <div class="ii-text">
                <h4>December Return Impact</h4>
                <p>Post-White Friday returns (-157k) wiped out December revenue, incurring extra fees.</p>
            </div>
        </div>
        <div class="insight-item">
            <div class="ii-icon">üöÄ</div>
            <div class="ii-text">
                <h4>Recommended Action</h4>
                <p><strong>1. Kill Bleeding SKUs:</strong> Stop ads on high-return items.<br><strong>2. Price Hike:</strong> Increase prices by 5-10% to cover FBA fees.</p>
            </div>
        </div>
    </div>

<script>
    // --- THEME LOGIC ---
    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', next);
        
        const icon = document.querySelector('.switch-handle');
        icon.innerText = next === 'light' ? '‚òæ' : '‚òÄ';
    }

    // --- DATA & RENDER (Unchanged) ---
    const rawData = {
        "Jan": [
            { s: "Shipped", q: 1813, p: 371472, g: 313183, r: 272333, c: 200873, pf: 71461, ret: 0, ads: -25158 },
            { s: "Return", q: 236, p: 58033, g: 48956, r: 42570, c: 32970, pf: 9601, ret: -4361, ads: 0 },
            { s: "Retail", q: 145, p: 93034, g: 84661, r: 73619, c: 62922, pf: 21739, ret: -3629, ads: 0 },
            { s: "Net", q: 1722, p: 406473, g: 319369, r: 303381, c: 230825, pf: 50451, ret: 0, ads: 0 } 
        ],
        "Feb": [
            { s: "Shipped", q: 2559, p: 524112, g: 438436, r: 381248, c: 287627, pf: 93621, ret: 0, ads: -55766 },
            { s: "Return", q: 229, p: 48879, g: 40998, r: 35661, c: 27152, pf: 8509, ret: -3914, ads: 0 },
            { s: "Retail", q: 125, p: 78438, g: 71378, r: 62068, c: 53671, pf: 17707, ret: -3939, ads: 0 },
            { s: "Net", q: 2455, p: 553671, g: 409136, r: 407655, c: 314146, pf: 39200, ret: 0, ads: 0 }
        ],
        "Mar": [
            { s: "Shipped", q: 3674, p: 721035, g: 592169, r: 514930, c: 407406, pf: 107524, ret: 0, ads: -74763 },
            { s: "Return", q: 402, p: 62338, g: 51055, r: 44395, c: 35928, pf: 8467, ret: -5918, ads: 0 },
            { s: "Retail", q: 67, p: 41801, g: 38039, r: 33078, c: 28406, pf: 9633, ret: -3761, ads: 0 },
            { s: "Net", q: 3339, p: 700497, g: 498473, r: 503612, c: 399884, pf: 24247, ret: 0, ads: 0 }
        ],
        "Apr": [
            { s: "Shipped", q: 2331, p: 571393, g: 469531, r: 408288, c: 329358, pf: 78930, ret: 0, ads: -38423 },
            { s: "Return", q: 395, p: 140244, g: 116892, r: 101645, c: 76087, pf: 25558, ret: -9688, ads: 0 },
            { s: "Retail", q: 8, p: 4831, g: 4396, r: 3823, c: 3317, pf: 1079, ret: -3357, ads: 0 },
            { s: "Net", q: 1944, p: 435980, g: 308923, r: 310465, c: 256588, pf: 2982, ret: 0, ads: 0 }
        ],
        "May": [
            { s: "Shipped", q: 1602, p: 480528, g: 411462, r: 357793, c: 277331, pf: 80462, ret: 0, ads: -39679 },
            { s: "Return", q: 179, p: 58859, g: 49612, r: 43141, c: 33558, pf: 9583, ret: -4401, ads: 0 },
            { s: "Retail", q: 13, p: 7614, g: 6929, r: 6025, c: 5169, pf: 1760, ret: -3694, ads: 0 },
            { s: "Net", q: 1436, p: 429283, g: 324698, r: 320677, c: 248942, pf: 24865, ret: 0, ads: 0 }
        ],
        "Jun": [
            { s: "Shipped", q: 1813, p: 483504, g: 405065, r: 352230, c: 281359, pf: 70871, ret: 0, ads: -42429 },
            { s: "Return", q: 188, p: 36990, g: 31168, r: 27103, c: 21238, pf: 5865, ret: -3231, ads: 0 },
            { s: "Retail", q: 13, p: 7684, g: 6992, r: 6080, c: 5246, pf: 1746, ret: -5067, ads: 0 },
            { s: "Net", q: 1638, p: 454198, g: 335229, r: 331208, c: 265367, pf: 16025, ret: 0, ads: 0 }
        ],
        "Jul": [
            { s: "Shipped", q: 2833, p: 844805, g: 720673, r: 626672, c: 518859, pf: 107813, ret: 0, ads: -57054 },
            { s: "Return", q: 231, p: 49225, g: 41124, r: 35760, c: 27062, pf: 8698, ret: -4272, ads: 0 },
            { s: "Retail", q: 6, p: 3746, g: 3409, r: 2964, c: 2531, pf: 878, ret: -7465, ads: 0 },
            { s: "Net", q: 2608, p: 799326, g: 621631, r: 593876, c: 494328, pf: 31201, ret: 0, ads: 0 }
        ],
        "Aug": [
            { s: "Shipped", q: 2524, p: 661507, g: 553957, r: 481702, c: 389304, pf: 92398, ret: 0, ads: -44869 },
            { s: "Return", q: 309, p: 82985, g: 70562, r: 61358, c: 50020, pf: 11338, ret: -6602, ads: 0 },
            { s: "Retail", q: 7, p: 4366, g: 3973, r: 3455, c: 2977, pf: 996, ret: -5700, ads: 0 },
            { s: "Net", q: 2222, p: 582888, g: 435897, r: 423798, c: 342261, pf: 24885, ret: 0, ads: 0 }
        ],
        "Sep": [
            { s: "Shipped", q: 2461, p: 668018, g: 548730, r: 477157, c: 391960, pf: 85196, ret: 7693, ads: -58816 },
            { s: "Return", q: 238, p: 67878, g: 57079, r: 49629, c: 40429, pf: 9200, ret: -5756, ads: 0 },
            { s: "Retail", q: 10, p: 7025, g: 6393, r: 5559, c: 4627, pf: 1766, ret: -4767, ads: 0 },
            { s: "Net", q: 2233, p: 607165, g: 433472, r: 433087, c: 356159, pf: 16116, ret: 0, ads: 0 }
        ],
        "Oct": [
            { s: "Shipped", q: 2447, p: 590563, g: 455108, r: 395746, c: 344111, pf: 51635, ret: 0, ads: -32101 },
            { s: "Return", q: 291, p: 63809, g: 50821, r: 44192, c: 36446, pf: 7746, ret: -6648, ads: 0 },
            { s: "Retail", q: 8, p: 4445, g: 4045, r: 3517, c: 3104, pf: 941, ret: -2783, ads: 0 },
            { s: "Net", q: 2164, p: 531198, g: 369584, r: 355072, c: 310769, pf: 3298, ret: 0, ads: 0 }
        ],
        "Nov": [
            { s: "Shipped", q: 6937, p: 2420445, g: 2086640, r: 1814470, c: 2022517, pf: -208048, ret: 645172, ads: -78122 },
            { s: "Return", q: 256, p: 70256, g: 55582, r: 48333, c: 41279, pf: 7054, ret: -6449, ads: 0 },
            { s: "Retail", q: 8, p: 5018, g: 4566, r: 3970, c: 3368, pf: 1198, ret: -2700, ads: 0 },
            { s: "Net", q: 6689, p: 2355206, g: 1951053, r: 1770108, c: 1984606, pf: 343998, ret: 0, ads: 0 }
        ],
        "Dec": [
            { s: "Shipped", q: 1830, p: 156781, g: 122852, r: 106828, c: 104194, pf: 2634, ret: 29348, ads: -29246 },
            { s: "Return", q: 622, p: 196775, g: 168453, r: 146481, c: 157698, pf: -11217, ret: -19598, ads: 0 },
            { s: "Retail", q: 34, p: 21714, g: 19760, r: 17183, c: 14541, pf: 5219, ret: -2754, ads: 0 },
            { s: "Net", q: 1242, p: -18279, g: -74684, r: -22470, c: -38963, pf: -3180, ret: 0, ads: 0 }
        ]
    };

    const format = (num) => new Intl.NumberFormat('en-US').format(Math.round(num));
    
    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.querySelector('.overlay').classList.toggle('active');
    }

    function toggleSmallChannels(el) {
        el.classList.toggle('dropdown-active');
        document.getElementById('sm-submenu').classList.toggle('open');
    }

    function scrollToStats() {
        document.getElementById('footer-summary').scrollIntoView({ behavior: 'smooth' });
    }

    function toggleInsight() {
        document.getElementById('insight-modal').classList.toggle('active');
    }

    function renderDashboard() {
        const container = document.getElementById('content-area');
        const months = Object.keys(rawData);
        
        let annualRev = 0, annualCost = 0, annualProfit = 0, annualAds = 0, annualSales = 0, annualQty = 0;

        months.forEach((month, index) => {
            const data = rawData[month];
            
            const netRow = data.find(r => r.s === 'Net') || {};
            const shippedRow = data.find(r => r.s === 'Shipped') || {}; 
            
            const mRev = netRow.r || 0;
            const mCost = netRow.c || 0;
            const mProfit = netRow.pf || 0;
            const mMargin = mRev !== 0 ? (mProfit / mRev) * 100 : 0;
            const mAds = shippedRow.ads || 0; 
            const mSales = netRow.p || 0; 
            const mQty = netRow.q || 0;

            annualRev += mRev;
            annualCost += mCost;
            annualProfit += mProfit;
            annualAds += mAds;
            annualSales += mSales;
            annualQty += mQty;

            let rowsHTML = '';
            data.forEach(row => {
                const isNet = row.s === 'Net';
                const rowClass = isNet ? 'row-net' : 
                                 (row.s === 'Shipped' ? 'row-shipped' : 
                                 (row.s === 'Return' ? 'row-return' : 'row-retail'));
                
                rowsHTML += `
                    <tr class="${rowClass}">
                        <td><div class="dot"></div>${row.s}</td>
                        <td>${format(row.q)}</td>
                        <td>${format(row.p)}</td>
                        <td>${format(row.g)}</td>
                        <td>${format(row.r)}</td>
                        <td>${format(row.c)}</td>
                        <td style="color:${row.pf >= 0 ? 'var(--c-success)' : 'var(--c-danger)'}">${format(row.pf)}</td>
                        <td>${row.ret !== 0 ? format(row.ret) : '-'}</td>
                        <td style="color:var(--c-danger)">${row.ads !== 0 ? format(row.ads) : '-'}</td>
                    </tr>
                `;
            });

            const marginColor = mMargin >= 15 ? '#10B981' : (mMargin > 5 ? '#FBBF24' : '#EF4444');

            const html = `
                <div class="month-wrapper" style="animation-delay: ${index * 0.1}s">
                    <div class="section-header">
                        <div class="section-title">${month} 2025</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="kpi-row">
                            <div class="mini-kpi">
                                <div class="mk-label">Total Revenue</div>
                                <div class="mk-value">${format(mRev)}</div>
                            </div>
                            <div class="mini-kpi">
                                <div class="mk-label">Net Profit</div>
                                <div class="mk-value" style="color:${mProfit>=0?'#10B981':'#EF4444'}">${format(mProfit)}</div>
                            </div>
                            <div class="mini-kpi">
                                <div class="mk-label">Net Margin</div>
                                <div class="mk-value" style="color:${marginColor}">
                                    ${mMargin.toFixed(1)}%
                                    <div class="prog-track"><div class="prog-fill" style="width:${Math.max(0, Math.min(100, mMargin))}%; background:${marginColor}"></div></div>
                                </div>
                            </div>
                            <div class="mini-kpi">
                                <div class="mk-label">Ad Spend</div>
                                <div class="mk-value" style="color:#EF4444">${format(mAds)}</div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="styled-table">
                                <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Qty</th>
                                        <th>Price</th>
                                        <th>GMV</th>
                                        <th>Revenue</th>
                                        <th>Cost</th>
                                        <th>Profit</th>
                                        <th>Ret Fees</th>
                                        <th>Ads</th>
                                    </tr>
                                </thead>
                                <tbody>${rowsHTML}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });

        const annualMargin = annualRev !== 0 ? (annualProfit / annualRev) * 100 : 0;
        document.getElementById('year-qty').innerText = format(annualQty); 
        document.getElementById('year-sales').innerText = format(annualSales);
        document.getElementById('year-rev').innerText = format(annualRev);
        document.getElementById('year-cost').innerText = format(annualCost);
        document.getElementById('year-ads').innerText = format(annualAds);
        document.getElementById('year-profit').innerText = format(annualProfit);
        document.getElementById('year-margin').innerText = annualMargin.toFixed(2) + "%";
    }

    function exportAmazonFullExcel() {
        const wb = XLSX.utils.book_new();
        let rows = [];

        const sTitle = { font: { sz: 14, bold: true, color:{rgb:"FFFFFF"} }, fill: { fgColor: { rgb: "000000" } } };
        const sMonth = { font: { bold: true, color: { rgb: "AC975B" } }, fill: { fgColor: { rgb: "111111" } } };
        const sHead = { font: { bold: true }, fill: { fgColor: { rgb: "DDDDDD" } }, border: { bottom: { style: "thin" } } };
        
        rows.push([{ v: "AMAZON 2025 FULL FINANCIAL REPORT", s: sTitle }]);
        rows.push([""]);

        Object.keys(rawData).forEach(m => {
            rows.push([{ v: m + " 2025", s: sMonth }]);
            rows.push([
                {v:"Status",s:sHead}, {v:"Qty",s:sHead}, {v:"Price",s:sHead}, {v:"GMV",s:sHead},
                {v:"Revenue",s:sHead}, {v:"Cost",s:sHead}, {v:"Profit",s:sHead}, {v:"Ret Fees",s:sHead}, {v:"Ads",s:sHead}
            ]);

            rawData[m].forEach(r => {
                let fontStyle = {};
                if(r.s === "Net") fontStyle = { bold: true, color: { rgb: "3B82F6" } };
                if(r.s === "Return") fontStyle = { color: { rgb: "EF4444" } };

                rows.push([
                    { v: r.s, s: { font: fontStyle } },
                    { v: r.q, t:'n' }, { v: r.p, t:'n', z:'#,##0' }, { v: r.g, t:'n', z:'#,##0' },
                    { v: r.r, t:'n', z:'#,##0' }, { v: r.c, t:'n', z:'#,##0' }, { v: r.pf, t:'n', z:'#,##0' },
                    { v: r.ret, t:'n', z:'#,##0' }, { v: r.ads, t:'n', z:'#,##0' }
                ]);
            });
            rows.push([""]);
        });

        const ws = XLSX.utils.aoa_to_sheet(rows);
        ws['!cols'] = [{wpx:80}, {wpx:60}, {wpx:80}, {wpx:80}, {wpx:80}, {wpx:80}, {wpx:80}, {wpx:80}, {wpx:80}];
        
        XLSX.utils.book_append_sheet(wb, ws, "Amazon Detailed");
        XLSX.writeFile(wb, "INHOUSE_Amazon_2025.xlsx");
    }

    renderDashboard();

</script>

</body>
</html>
